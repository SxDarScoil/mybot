import asyncio
from aiogram import Bot, Dispatcher, types
from aiogram.filters import Command

API_TOKEN = "YOUR_TELEGRAM_BOT_TOKEN"  # <-- –í—Å—Ç–∞–≤—å —Ç–æ–∫–µ–Ω
OWNER_ID = 123456789  # <-- –í—Å—Ç–∞–≤—å —Å–≤–æ–π Telegram ID

bot = Bot(token=API_TOKEN)
dp = Dispatcher()

# –°–ª–æ–≤–∞—Ä—å –∫–æ–¥–æ–≤: "–∫–æ–¥": "–Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞"
movies = {}


# --- –ö–æ–º–∞–Ω–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–∏–ª—å–º–∞ –≤–ª–∞–¥–µ–ª—å—Ü–µ–º ---
@dp.message(Command("add"))
async def add_movie(message: types.Message):
    if message.from_user.id != OWNER_ID:
        return await message.answer("‚õî –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É.")

    text = message.text.replace("/add", "").strip()

    if "|" not in text:
        return await message.answer(
            "‚ùó –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç.\n–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:\n"
            "`/add <–∫–æ–¥> | <–Ω–∞–∑–≤–∞–Ω–∏–µ>`"
        )

    code, title = [part.strip() for part in text.split("|", 1)]

    if not code or not title:
        return await message.answer("‚ùó –ö–æ–¥ –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º–∏.")

    code = code.upper()

    movies[code] = title

    await message.answer(
        f"üé¨ –§–∏–ª—å–º —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!\n"
        f"–ö–æ–¥: `{code}`\n–ù–∞–∑–≤–∞–Ω–∏–µ: *{title}*"
    )


# --- –í—ã–≤–æ–¥ —Å–ø–∏—Å–∫–∞ —Ñ–∏–ª—å–º–æ–≤ (—Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—É) ---
@dp.message(Command("list"))
async def list_movies(message: types.Message):
    if message.from_user.id != OWNER_ID:
        return await message.answer("‚õî –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É.")

    if not movies:
        return await message.answer("–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—É—Å—Ç–∞.")

    text = "üìö *–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Ñ–∏–ª—å–º–æ–≤:*\n\n"
    for code, title in movies.items():
        text += f"`{code}` ‚Äî {title}\n"

    await message.answer(text)


# --- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∫–æ–¥ ---
@dp.message()
async def user_code(message: types.Message):
    code = message.text.strip().upper()

    if code in movies:
        await message.answer(f"üé¨ –ü–æ –∫–æ–¥—É `{code}` –Ω–∞–π–¥–µ–Ω —Ñ–∏–ª—å–º:\n*{movies[code]}*")
    else:
        await message.answer("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥.")


async def main():
    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω...")
    await dp.start_polling(bot)


if __name__ == "__main__":
    asyncio.run(main())
